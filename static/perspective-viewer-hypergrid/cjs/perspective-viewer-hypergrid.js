!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("faux-hypergrid/src/lib/Canvas"),require("@finos/perspective-viewer/dist/esm/custom_styles"),require("faux-hypergrid/src/cellEditors/Textfield"),require("core-js/modules/web.dom-collections.iterator"),require("faux-hypergrid/src/behaviors/Behavior"),require("lodash/isEqual"),require("faux-hypergrid/src/cellRenderers"),require("@finos/perspective-viewer/dist/esm/utils.js"),require("lodash/cloneDeep"),require("@finos/perspective/dist/esm/config"),require("faux-hypergrid"),require("faux-hypergrid/src/Base"),require("fin-hypergrid-grouped-header-plugin"),require("rectangular"),require("superscript-number"),require("@finos/perspective/dist/esm/config/index.js"),require("datasaur-local"),require("core-js/modules/es.string.replace")):"function"==typeof define&&define.amd?define(["faux-hypergrid/src/lib/Canvas","@finos/perspective-viewer/dist/esm/custom_styles","faux-hypergrid/src/cellEditors/Textfield","core-js/modules/web.dom-collections.iterator","faux-hypergrid/src/behaviors/Behavior","lodash/isEqual","faux-hypergrid/src/cellRenderers","@finos/perspective-viewer/dist/esm/utils.js","lodash/cloneDeep","@finos/perspective/dist/esm/config","faux-hypergrid","faux-hypergrid/src/Base","fin-hypergrid-grouped-header-plugin","rectangular","superscript-number","@finos/perspective/dist/esm/config/index.js","datasaur-local","core-js/modules/es.string.replace"],t):"object"==typeof exports?exports["perspective-viewer-hypergrid"]=t(require("faux-hypergrid/src/lib/Canvas"),require("@finos/perspective-viewer/dist/esm/custom_styles"),require("faux-hypergrid/src/cellEditors/Textfield"),require("core-js/modules/web.dom-collections.iterator"),require("faux-hypergrid/src/behaviors/Behavior"),require("lodash/isEqual"),require("faux-hypergrid/src/cellRenderers"),require("@finos/perspective-viewer/dist/esm/utils.js"),require("lodash/cloneDeep"),require("@finos/perspective/dist/esm/config"),require("faux-hypergrid"),require("faux-hypergrid/src/Base"),require("fin-hypergrid-grouped-header-plugin"),require("rectangular"),require("superscript-number"),require("@finos/perspective/dist/esm/config/index.js"),require("datasaur-local"),require("core-js/modules/es.string.replace")):e["perspective-viewer-hypergrid"]=t(e["faux-hypergrid/src/lib/Canvas"],e["@finos/perspective-viewer/dist/esm/custom_styles"],e["faux-hypergrid/src/cellEditors/Textfield"],e["core-js/modules/web.dom-collections.iterator"],e["faux-hypergrid/src/behaviors/Behavior"],e["lodash/isEqual"],e["faux-hypergrid/src/cellRenderers"],e["@finos/perspective-viewer/dist/esm/utils.js"],e["lodash/cloneDeep"],e["@finos/perspective/dist/esm/config"],e["faux-hypergrid"],e["faux-hypergrid/src/Base"],e["fin-hypergrid-grouped-header-plugin"],e.rectangular,e["superscript-number"],e["@finos/perspective/dist/esm/config/index.js"],e["datasaur-local"],e["core-js/modules/es.string.replace"])}(window,(function(__WEBPACK_EXTERNAL_MODULE__0__,__WEBPACK_EXTERNAL_MODULE__1__,__WEBPACK_EXTERNAL_MODULE__2__,__WEBPACK_EXTERNAL_MODULE__3__,__WEBPACK_EXTERNAL_MODULE__5__,__WEBPACK_EXTERNAL_MODULE__6__,__WEBPACK_EXTERNAL_MODULE__7__,__WEBPACK_EXTERNAL_MODULE__8__,__WEBPACK_EXTERNAL_MODULE__9__,__WEBPACK_EXTERNAL_MODULE__10__,__WEBPACK_EXTERNAL_MODULE__11__,__WEBPACK_EXTERNAL_MODULE__12__,__WEBPACK_EXTERNAL_MODULE__13__,__WEBPACK_EXTERNAL_MODULE__14__,__WEBPACK_EXTERNAL_MODULE__15__,__WEBPACK_EXTERNAL_MODULE__16__,__WEBPACK_EXTERNAL_MODULE__20__,__WEBPACK_EXTERNAL_MODULE__22__){return function(e){var t={};function i(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(o,r,function(t){return e[t]}.bind(null,r));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=23)}([function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__0__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__1__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__2__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__3__},function(e,t,i){const o="|",r=i(5).prototype.treeColumnIndex;function n(e,t,i){const o=Object.keys(e),n=o.length>0?o[0]:void 0;if(void 0===n)return[];const s=!!t.length,a=t.length?i.filter(e=>"__ROW_PATH__"!==e):i,l=o.map(e=>a.indexOf(e)),d=[];for(let i=0;i<e[n].length;i++){const n={};for(const t in o){const r=o[t];n[l[t]]=e[r][i]}if(s){void 0===e.__ROW_PATH__[i]&&(e.__ROW_PATH__[i]=[]);let o=e.__ROW_PATH__[i][e.__ROW_PATH__[i].length-1];void 0===o&&0===i&&(o="TOTAL"),n[r]={rollup:o,rowPath:["ROOT"].concat(e.__ROW_PATH__[i]),isLeaf:e.__ROW_PATH__[i].length>=t.length}}e.__ID__&&(n.__ID__=e.__ID__[i].join("|")),e.__INDEX__&&(n.__INDEX__=e.__INDEX__[i][0]),d.push(n)}return d}e.exports={psp2hypergrid:function(e,t,i,r,s){const a=(r.length?s.filter(e=>"__ROW_PATH__"!==e):s).map(e=>e.split(o)),l=!!r.length;return{rows:n(e,r,s),isTree:l,configuration:{},rowPivots:r,columnPaths:(l?[[" "]]:[]).concat(a),columnTypes:(l?[r.map(e=>i[e])]:[]).concat(a.map(e=>t[e[e.length-1]]))}},page2hypergrid:n}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__5__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__6__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__7__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__8__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__9__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__10__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__11__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__12__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__13__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__14__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__15__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__16__},function(e,t){e.exports="\x3c!--\n   \n   Copyright (c) 2017, the Perspective Authors.\n   \n   This file is part of the Perspective library, distributed under the terms of\n   the Apache License 2.0.  The full license can be found in the LICENSE file.\n\n--\x3e\n\n<template id='perspective-hypergrid'>\n    <div id='gridWrapper'>\n        <div id='mainGrid'></div>\n    </div>\n</template>"},function(e,t,i){(e.exports=i(21)(!1)).push([e.i,':host{position:absolute;outline:0;top:0;left:0;bottom:0;right:0}:host table{font:12px "Open Sans",helvetica,sans-serif}:host td.hover{background-color:#eee}:host tr.hover{background-color:#f6f6f6}:host td.positive{color:#1078d1}:host td.negative{color:#de3838}:host input.hypergrid-textfield{position:absolute;outline:0;border:1px solid var(--hypergrid-editor--border-color,rgba(0,0,0,.4));color:var(--hypergrid--color,inherit);background:var(--hypergrid--background,#fff);box-sizing:border-box;padding:0 4px 3px 5px}:host #gridWrapper{box-sizing:border-box;width:100%;height:100%;margin:0;padding:var(--hypergrid--padding,0)}:host #mainGrid{position:relative;width:100%;height:100%;margin:0;padding:0}:host #mainGrid>div{position:absolute;width:100%;height:100%;overflow:hidden}:host #mainGrid input{margin:0}:host div.finbar-vertical{margin:0!important;width:15px!important;box-shadow:0 0 0 #000,0 0 0 #000,0 0 0 #000}:host div.finbar-vertical div.thumb{width:var(--hypergrid-scrollbar--width,13px);right:-1px;background-color:#9e9e9e;box-shadow:0 0 0 #000,0 0 0 #000,0 0 0 #000;margin:0!important;border-radius:var(--hypergrid-scrollbar--border-radius,0)}:host div.finbar-horizontal{margin:0!important;height:15px!important;box-shadow:0 0 0 #000,0 0 0 #000,0 0 0 #000}:host div.finbar-horizontal div.thumb{margin:-3px 2px;height:var(--hypergrid-scrollbar--width,13px);bottom:4px;background-color:#9e9e9e;box-shadow:0 0 0 #000,0 0 0 #000,0 0 0 #000;border-radius:var(--hypergrid-scrollbar--border-radius,0)}',""])},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return set_formatters}));var core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3),core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_web_dom_collections_iterator__WEBPACK_IMPORTED_MODULE_0__),_finos_perspective_dist_esm_config__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(10),_finos_perspective_dist_esm_config__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_finos_perspective_dist_esm_config__WEBPACK_IMPORTED_MODULE_1__);function null_formatter(e,t=""){let i=e.format.bind(e);return e.format=e=>{if("string"==typeof e)return e;if(t===e)return"-";let o=i(e);return""===o?"-":o},e}function custom_formatter(e,t){let i=e.format.bind(e);return e.format=e=>(e=t(i(e)))||"-",e}function set_formatters(grid){const formatters={};for(const type of Object(_finos_perspective_dist_esm_config__WEBPACK_IMPORTED_MODULE_1__.get_types)()){const config=Object(_finos_perspective_dist_esm_config__WEBPACK_IMPORTED_MODULE_1__.get_type_config)(type),format_function={float:grid.localization.NumberFormatter,integer:grid.localization.NumberFormatter,datetime:grid.localization.DateFormatter,date:grid.localization.DateFormatter}[config.type||type];format_function&&("string"==typeof config.format?formatters[type]=custom_formatter(new format_function("en-us"),eval(config.format)):formatters[type]=null_formatter(new format_function("en-us",config.format),config.null_value),grid.localization.add(`perspective-${type}`,formatters[type]))}grid.localization.header={format:e=>grid.behavior.formatColumnHeader(e)},grid.localization.add("FinanceTree",{format:function(e,t){const i=formatters[t];return i?i.format(e):e},parse:e=>e})}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__20__},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i=e[1]||"",o=e[3];if(!o)return i;if(t&&"function"==typeof btoa){var r=(s=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),n=o.sources.map((function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"}));return[i].concat(n).concat([r]).join("\n")}var s;return[i].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+i+"}":i})).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},r=0;r<this.length;r++){var n=this[r][0];"number"==typeof n&&(o[n]=!0)}for(r=0;r<e.length;r++){var s=e[r];"number"==typeof s[0]&&o[s[0]]||(i&&!s[2]?s[2]=i:i&&(s[2]="("+s[2]+") and ("+i+")"),t.push(s))}},t}},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__22__},function(e,t,i){"use strict";i.r(t);var o={};i.r(o),i.d(o,"install",(function(){return O}));i(3);var r=i(11),n=i.n(r),s=i(12),a=i.n(s),l=i(0),d=i.n(l),c=i(13),_=i.n(c),h=i(14),u=i.n(h),g=i(15),p=i.n(g),f=i(6),v=i.n(f),m=i(7),b=i.n(m),w=b.a.BaseClass.extend("Borders",{paint:function(e,t){var i,o=t.bounds,r=o.x,n=o.y,s=o.width,a=o.height-1;e.save(),e.translate(-.5,.5),e.cache.lineWidth=1,(i=t.borderTop)&&(e.beginPath(),e.moveTo(r,n),e.lineTo(r+s,n),e.cache.strokeStyle=i,e.stroke()),(i=t.borderRight)&&(e.beginPath(),e.moveTo(r+s,n),e.lineTo(r+s,n+a),e.cache.strokeStyle=i,e.stroke()),(i=t.borderBottom)&&(e.beginPath(),e.moveTo(r,n+a),e.lineTo(r+s,n+a),e.cache.strokeStyle=i,e.stroke()),(i=t.borderLeft)&&(e.beginPath(),e.moveTo(r,n),e.lineTo(r,n+a),e.cache.strokeStyle=i,e.stroke()),e.restore()}});function E(e,t=!1){const i=[];e.isTree&&(i[this.treeColumnIndex]={name:this.treeColumnIndex.toString(),header:" "}),e.columnPaths.forEach((function(t,o){const r=t.join("|"),n=e.configuration.columnAliases,s=n&&n[r]||r,a=o.toString(),l=e.columnTypes[o];e.isTree&&0===o?i[-1]={name:a,header:s,type:l}:i.push({name:a,header:s,type:l,index:o-(e.isTree?1:0)})})),this.grid.properties.showTreeColumn=e.isTree;const o=this.grid.behavior.dataModel._config,r=!(0===o.row_pivots.length&&o.column_pivots.length>0)&&this.grid.behavior.dataModel._viewer.hasAttribute("selectable");this.grid.addProperties(this.grid.get_dynamic_styles(r)),this.createColumns=y,this.refreshColumns=C,!t&&this._memoized_schema&&v()(this._memoized_schema.slice(0,this._memoized_schema.length),i.slice(0,i.length))&&v()(e.rowPivots,this._memoized_pivots)?(this.grid.sbVScroller.index=0,this.grid.behavior.dataModel.data=e.rows,this.grid.behavior.dataModel._data_window=void 0):(this.grid.sbVScroller.index=0,this.grid.sbHScroller.index=0,this.grid.selectionModel.clear(),this.grid.setData({data:e.rows,schema:i})),this._memoized_schema=i,this._memoized_pivots=e.rowPivots}function y(){Object.getPrototypeOf(this).createColumns.call(this),this.refreshColumns(),this.setHeaders(),this.schema_loaded=!0}function C(){this.getActiveColumns().forEach((function(e){x.call(this,e)}),this);let e=this.getTreeColumn();e&&x.call(this,e)}function x(e){const t=e.properties;e.index===this.treeColumnIndex?t.format="FinanceTree":t.format=`perspective-${e.type}`;const i=this.grid.behavior.dataModel._config;this.grid.behavior.dataModel._viewer.hasAttribute("editable")&&0===i.row_pivots.length&&0===i.column_pivots.length&&(t.editor={integer:"perspective-number",string:"perspective-text",date:"perspective-date",datetime:"perspective-datetime",float:"perspective-number"}[e.type],Object.assign(t,{editable:!0,editOnKeydown:!0,editOnNextCell:!1,editOnDoubleClick:!0,editorActivationKeys:["alt","esc"],cellSelection:!0}));const o=this.grid.get_styles();o[e.type]&&Object.assign(t,o[e.type])}function P(e){const t=this.dataModel.getConfig(),i=t.sort.findIndex(t=>t[0]===e.trim());if(i>-1){const o=t.sort[i][1];o in this.charMap&&(e=`${e} ${this.charMap[o]}${t.sort.length>1?p()(i+1):""}`)}return e}function S(e){e.preventDefault(),e.handled=!0;const t=this.behavior.dataModel.getConfig(),i=this.behavior.getColumn(e.detail.column);let o,r;t.column_pivots.length>0?(o=!0,r=i.header.split("|")[t.column_pivots.length]):(o=!1,r=i.header);const n=this.behavior.dataModel._viewer,s=t.sort.findIndex(e=>e[0]===r.trim()),a=s>-1,l=e.detail.keys&&(e.detail.keys.indexOf("ALTSHIFT")>-1||e.detail.keys.indexOf("ALT")>-1)&&"string"!==i.type,d=e.detail.keys&&(e.detail.keys.indexOf("ALTSHIFT")>-1||e.detail.keys.indexOf("SHIFT")>-1);let c;if(a){const e=t.sort[s],i=e[1];c=n._increment_sort(i,o,l),e[1]=c}else c=n._increment_sort("none",o,l);d&&a?("none"===c&&t.sort.splice(s,1),n.sort=JSON.stringify(t.sort)):d?(t.sort.push([r,c]),n.sort=JSON.stringify(t.sort)):n.sort=JSON.stringify([[r,c]])}b.a.add(w);const M=e=>{const t=e.detail.primitiveEvent,i=new MouseEvent(t.type,t);e.target.parentElement.parentElement.parentElement.dispatchEvent(i)};async function R(e,t){const i=this.dataModel.getConfig(),o=i.row_pivots,r=i.column_pivots,n=e>=0?e:0,s=n+1,a=await this.dataModel._view.to_json({start_row:n,end_row:s}),l=a.map(e=>e.__ROW_PATH__)[0]||[],d=o.map((e,t)=>{const i=l[t];return i?[e,"==",i]:void 0}).filter(e=>e),c=o.length>0?t+1:t,_=Object.keys(a[0])[c],h={row:a[0]};let u=[];if(_){const e=_.split("|");h.column_names=[e[e.length-1]],u=r.map((t,i)=>{const o=e[i];return o?[t,"==",o]:void 0}).filter(e=>e).filter(([,,e])=>"__ROW_PATH__"!==e)}const g=i.filter.concat(d).concat(u);return h.config={filters:g},h}const O=function(e){var t;function i(e){var t=this.behavior.getCursorAt(-1,-1),i=this.hoverCell;if(i&&i.x>-2&&i.y>-1){var o=i.x+this.getHScrollValue();t=this.behavior.getCursorAt(o,i.y+this.getVScrollValue(),e)}this.beCursor(t)}t=e.behavior.charMap,Object.assign(t,{asc:"\u2191",desc:"\u2193","asc abs":"\u21e7","desc abs":"\u21e9","col asc":"\u2192","col desc":"\u2190","col asc abs":"\u21e8","col desc abs":"\u21e6"}),Object.getPrototypeOf(e.behavior).setPSP=E,Object.getPrototypeOf(e.behavior).formatColumnHeader=P,e.addEventListener("fin-column-sort",S.bind(e)),e.addEventListener("fin-canvas-context-menu",M),e.addEventListener("fin-row-selection-changed",(async function(e){const t=e.detail.rows,i=t.length>0,o=i?await R.call(e.detail.grid.behavior,t[0]):{config:{filters:[]}};e.detail.grid.canvas.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:i,...o}}))})),Object.getPrototypeOf(e.behavior).getCursorAt=function(e,t,i){var o,r,n;const s=null===(o=this.dataModel.data[t-1])||void 0===o?void 0:null===(r=o[-1])||void 0===r?void 0:null===(n=r.rowPath)||void 0===n?void 0:n.length;if(!!this.grid.properties.rowSelection){if(-1===e&&s<=this.dataModel._config.row_pivots.length&&(null==i?void 0:i.gridPoint.x)<=15*s+10)return"pointer"}else if(-1===e&&s<=this.dataModel._config.row_pivots.length)return"pointer"},Object.getPrototypeOf(e.behavior).onMouseMove=function(e,t){this.featureChain&&(this.featureChain.handleMouseMove(e,t),i.call(e,t),this.featureChain.setCursor(e))},Object.getPrototypeOf(e.behavior).cellClicked=async function(e){var t,i,o;e.primitiveEvent.preventDefault(),e.handled=!0;const{x:r,y:n}=e.dataCell,s=this.dataModel.getConfig(),a=s.row_pivots,l=s.column_pivots,d=n>=0?n:0,c=d+1,_=await this.dataModel._view.to_json({start_row:d,end_row:c}),h=_.map(e=>e.__ROW_PATH__)[0]||[],u=a.map((e,t)=>{const i=h[t];return i?[e,"==",i]:void 0}).filter(e=>e),g=a.length>0?r+1:r,p=Object.keys(_[0])[g];let f,v=[];if(p){const e=p.split("|");f=[e[e.length-1]],v=l.map((t,i)=>{const o=e[i];return o?[t,"==",o]:void 0}).filter(e=>e).filter(([,,e])=>"__ROW_PATH__"!==e)}const m=s.filter.concat(u).concat(v);if(this.grid.properties.rowSelection){const e=this.grid.getSelectedRows(),t=e[0]===n;0===e.length&&delete this.dataModel._selected_row_index,this.grid.canvas.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:t,config:{filters:t?m:[]},column_names:f,row:_[0]}}))}this.grid.canvas.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:await R.call(this,n,r)}));const b=null===(t=this.dataModel.data[n])||void 0===t?void 0:null===(i=t[-1])||void 0===i?void 0:null===(o=i.rowPath)||void 0===o?void 0:o.length;if(!this.grid.properties.rowSelection||(null==e?void 0:e.gridPoint.x)<=15*b+10)return this.dataModel.toggleRow(e.dataCell.y,e.dataCell.x,e)};const o=e.renderer.renderGrid;function r(){this.width=Math.floor(this.div.clientWidth),this.height=Math.floor(this.div.clientHeight),this.bounds=new u.a.Rectangle(0,0,this.width,this.height),this.component.setBounds(this.bounds)}e.renderer.renderGrid=function(e){o.call(this,e),this.renderOverrides(e),this.renderLastSelection(e)},e.canvas.canvas.addEventListener("mousewheel",e=>{e.shiftKey&&e.stopPropagation()}),e.canvas.hasFocus=function(){var t;if(!(null===(t=e.div)||void 0===t?void 0:t.isConnected))return;const i=e.div.parentNode.parentNode.host;return i.parentNode.parentNode.parentNode.parentNode.parentNode.activeElement===i},e.lookupFeature("CellSelection").handleMouseDown=function(e,t){var i=t.gridCell.x,o=t.dataCell.y;if(e.behavior.getCellProperty(t.dataCell.x,t.gridCell.y,"cellSelection")&&t.isDataCell&&!t.primitiveEvent.detail.isRightClick){var r=e.newPoint(i,o),n=t.primitiveEvent.detail.keys;this.extendSelection(e,r,n)}else this.next&&this.next.handleMouseDown(e,t)},e.lookupFeature("CellSelection").extendSelection=function(e,t,i){var o=i.indexOf("CTRL")>=0,r=e.getMouseDown(),n=t.x,s=t.y;if(!(n<0||s<0)){if(o&&n===r.x&&s===r.y)return e.clearMostRecentSelection(),e.popMouseDown(),void e.repaint();o||e.clearSelections(),e.select(n,s,0,0),e.setMouseDown(e.newPoint(n,s)),e.setDragExtent(e.newPoint(0,0)),e.repaint()}},e.lookupFeature("CellSelection").handleDOWN=function(e,t){if(t.primitiveEvent.preventDefault(),!e.cellEditor){const t=this.getAutoScrollAcceleration();let{x:i,y:o}=e.selectionModel.getLastSelection().origin;o+t>e.renderer.dataWindow.origin.y+e.renderer.dataWindow.extent.y-2&&e.sbVScroller.index++,o=Math.min(e.behavior.dataModel.getRowCount()-1,o+t),e.selectionModel.select(i,o,0,0),e.repaint()}},e.lookupFeature("CellSelection").handleUP=function(e,t){if(t.primitiveEvent.preventDefault(),!e.cellEditor){const t=this.getAutoScrollAcceleration();let{x:i,y:o}=e.selectionModel.getLastSelection().origin;o-t<e.renderer.dataWindow.origin.y&&e.sbVScroller.index--,o=Math.max(0,o-t),e.selectionModel.select(i,o,0,0),e.repaint()}},e.lookupFeature("CellSelection").handleLEFT=function(e,t){if(t.primitiveEvent.preventDefault(),!e.cellEditor){const t=this.getAutoScrollAcceleration();let{x:i,y:o}=e.selectionModel.getLastSelection().origin;i-t<e.renderer.dataWindow.origin.x&&e.sbHScroller.index--,i=Math.max(0,i-1),e.selectionModel.select(i,o,0,0),e.repaint()}},e.lookupFeature("CellSelection").handleRIGHT=function(e,t){if(t.primitiveEvent.preventDefault(),!e.cellEditor){const t=this.getAutoScrollAcceleration();let{x:i,y:o}=e.selectionModel.getLastSelection().origin;i+t>e.renderer.dataWindow.origin.x+e.renderer.dataWindow.extent.x-1&&e.sbHScroller.index++,i=Math.min(e.behavior.schema.length-1,i+t),e.selectionModel.select(i,o,0,0),e.repaint()}},e.lookupFeature("CellSelection").moveShiftSelect=function(e,t,i){e.moveSingleSelect(t,i)},e.canvas.resize=async function(t){let i=1;const o=window.devicePixelRatio&&this.component.properties.useHiDPI;if(o){i=(window.devicePixelRatio||1)/(this.gc.webkitBackingStorePixelRatio||this.gc.mozBackingStorePixelRatio||this.gc.msBackingStorePixelRatio||this.gc.oBackingStorePixelRatio||this.gc.backingStorePixelRatio||1)}r.call(this);let n=!0;const s=performance.now(),a=this.component.grid.behavior.dataModel;if(this.height*i!==this.canvas.height||this.width*i!==this.canvas.width||t)for(;a._view&&n;){if(performance.now()-s>3e3)throw new Error("Timeout");"object"==typeof n&&await new Promise(setTimeout),e.renderer.computeCellsBounds(!0),n=await new Promise(e=>a.fetchData(void 0,e))}this.buffer.width=this.canvas.width=this.width*i,this.buffer.height=this.canvas.height=this.height*i,this.canvas.style.width=this.buffer.style.width=this.width+"px",this.canvas.style.height=this.buffer.style.height=this.height+"px",this.bc.scale(i,i),o&&!this.component.properties.useBitBlit&&this.gc.scale(i,i),a._view&&this.resizeNotification(),this.component.grid.renderer.needsComputeCellsBounds=!1,e.canvas.paintNow()}};var A=i(5),T=i.n(A),L=i(16),D=i(4);const{prototype:{treeColumnIndex:k}}=T.a;function H(e){if(!this.dataWindow)return[];const t=this.dataWindow;return this.grid.newRectangle(t.left,t.top,t.width,e?Math.min(e-t.top,t.height):t.height)}function B(e,t){for(let i in e)if(e[i].__ID__===t)return parseInt(i);return-1}var N,W=i(20).extend("PerspectiveDataModel",{isTreeCol:function(e){return e===k&&this.isTree()},getValue:function(e,t){var i=this.data[t];return i?i[e]:null},getRowCount:function(){return this._nrows||0},getConfig:function(){return this._config},setRowCount:function(e){this._nrows=e||0},isTree:function(){return this._isTree},setIsTree:function(e){this._isTree=e},setDirty:function(e){this._grid&&(e!==this._nrows&&(this._nrows=e,this._grid.synchronizeScrollingBoundaries()),this._dirty=!0)},toggleRow:async function(e,t,i){if(this.isTreeCol(t)){let o=!1;i.primitiveEvent.detail.primitiveEvent&&(o=!!i.primitiveEvent.detail.primitiveEvent.shiftKey);let r=await this._view.get_row_expanded(e);o?r?1===this.data[e][t].rowPath.length?this._view.collapse(e):this._view.set_depth(this.data[e][t].rowPath.length-2):this._view.set_depth(this.data[e][t].rowPath.length-1):r?this._view.collapse(e):this._view.expand(e);let n=await this._view.num_rows();this.setDirty(n),this._grid.canvas.paintNow()}},_update_select_index:function(){const e=this._grid.selectionModel.hasSelections(),t=this._grid.selectionModel.hasRowSelections();if(e){const e=this.data[this._grid.selectionModel.getLastSelection().origin.y];e&&(this._selected_cell_index=e.__ID__)}if(t){const e=this.data[this._grid.getSelectedRows()[0]];e&&(this._selected_row_index=e.__ID__)}},_update_editor:function(e){const t=this._grid.cellEditor;let i;return t&&(i=B(this.data,t._index),t.event.resetGridXY(t.event.dataCell.x,i-e.origin.y+1),t.moveEditor()),i},_update_selection:function(e){if(this._grid.selectionModel.hasSelections()&&-1!==(e=e||B(this.data,this._selected_cell_index))){const t=this._grid.selectionModel.getLastSelection().origin.x;this._grid.selectionModel.select(t,e,0,0)}if(this._selected_row_index){this._grid.selectionModel.clearRowSelection();const t=e||B(this.data,this._selected_row_index);-1!==t&&this._grid.selectionModel.selectRow(t)}},getSelectedRowID(){if(this._grid.selectionModel.hasRowSelections()){const e=this.data[this._grid.getSelectedRows()[0]];if(e)return e.__ID__}},setSelectedRowID(e){this._grid.properties.rowSelection&&(this._selected_row_index=e,this._update_selection())},pspFetch:async function(e){const t=this._grid.properties.rowSelection||this._viewer.hasAttribute("editable"),i=function(e,t=[],i=!1){const o={start_row:e.origin.y,end_row:e.corner.y+1,start_col:e.origin.x,end_col:e.corner.x+3};return o.end_col+=t&&t.length>0?1:0,o.id=i,o}(e,this._config.row_pivots,t),o=await this._view.to_columns(i);this.data=[];const r=Object(D.page2hypergrid)(o,this._config.row_pivots,this._columns),n=i.start_row,s=this.data;r.forEach((e,t)=>s[n+t]=e)},fetchData:(N=async function(){if(void 0===this._view)return!0;let e=H.call(this._grid.renderer);if(!this._dirty&&!j(e,this._data_window))return;if(this._grid.renderer.needsComputeCellsBounds=!0,this._outstanding&&!j(e,this._outstanding.rect))return await this._outstanding.req,this._grid.renderer.needsComputeCellsBounds=!0,!0;this._dirty=!1;const t=this.pspFetch(e);this._outstanding={rect:e,req:t},this._update_select_index();try{await t}finally{this._outstanding=void 0,this._grid.renderer.needsComputeCellsBounds=!0}return this._data_window=e,this._update_selection(this._update_editor(e)),e=H.call(this._grid.renderer),j(e,this._data_window)},async function(e,t){let i;try{i=await N.call(this)}catch(e){return void t(e)}t(i)}),getCellEditorAt:function(e,t,i,o){if(!i)return;const r=this._grid.renderer.dataWindow.top,n=this._grid.cellEditors.create(i,o);this._grid.selectionModel.select(e,t+r-1),n.el.addEventListener("blur",()=>setTimeout(()=>n.cancelEditing()));const s={start_row:t+r-1,end_row:t+r,start_col:e,end_col:e+1,index:!0};return n._row=this._view.to_json(s),n._table=this._table,n._data=this.data,n._canvas=this._grid.canvas.canvas,n._index=this.data[t+r-1].__ID__,n},getCell:function(e,t){var i,o;return e.isUserDataArea?$.call(this,e,t):e.dataCell.x===k&&e.value&&(o=(i=this.getRow(e.dataCell.y+1))?e.value.rowPath.length-i[k].rowPath.length:1,e.last=0!==o,e.expanded=o<0,e._type=this.schema[-1].type[e.value.rowPath.length-2]),e.grid.cellRenderers.get(t)},clearSelectionState:function(){this._selected_row_index=void 0,this._selected_cell_index=void 0,this._grid.selectionModel.clear()}});function j(e,t){return!t||e.top!==t.top||e.top+e.height!==t.top+t.height||e.left!==t.left||e.left+e.width!==t.left+t.width}function $(e){if(null===e.value||void 0===e.value)e.value="-";else{let t=this.schema[e.dataCell.x].type;const i=Object(L.get_type_config)(t);i.type&&(t=i.type),["number","float","integer"].indexOf(t)>-1?0===e.value?e.value="float"===t?"0.00":"0":isNaN(e.value)?e.value="-":e.value>0?(e.color=e.columnColorNumberPositive||"rgb(160,207,255)",e.backgroundColor=e.columnBackgroundColorNumberPositive?e.columnBackgroundColorNumberPositive:e.backgroundColor,e.borderBottom=e.borderBottomPositive?e.borderBottomPositive:e.borderBottom,e.borderRight=e.borderRightPositive?e.borderRightPositive:e.borderRight):(e.color=e.columnColorNumberNegative||"rgb(255,136,136)",e.backgroundColor=e.columnBackgroundColorNumberNegative?e.columnBackgroundColorNumberNegative:e.backgroundColor,e.borderBottom=e.borderBottomNegative?e.borderBottomNegative:e.borderBottom,e.borderRight=e.borderRightNegative?e.borderRightNegative:e.borderRight):"boolean"===t&&(e.value=String(e.value))}}var K=i(8),X=i(17),I=i.n(X),U=i(18),q=i.n(U),F=i(1),V=i(9),z=i.n(V);const G=new F.PropsBuilder,Y="--hypergrid";function J(e){return G.get_properties(e)}G.add_fonts({font:Y,columnHeaderFont:`${Y}-header`,columnHeaderForegroundSelectionFont:`${Y}-header`,foregroundSelectionFont:`${Y}-header`,treeHeaderForegroundSelectionFont:[`${Y}-tree-header-selection`,`${Y}-header`],rowHeaderFont:Y,treeHeaderFont:Y}),G.add_styles({treeHeaderBackgroundColor:`${Y}-tree-header--background`,backgroundColor:`${Y}--background`,treeHeaderColor:`${Y}-tree-header--color`,treeHeaderForegroundSelectionColor:[`${Y}-tree-header-selection--color`,`${Y}--color`],treeHeaderBackgroundSelectionColor:[`${Y}-tree-header-selection--background`,`${Y}-selection--background`],backgroundSelectionColor:`${Y}-selection--background`,foregroundSelectionColor:[`${Y}--color`,"color"],borderBottom:`${Y}--border-bottom-color`,borderRight:`${Y}--border-right-color`,borderBottomPositive:`${Y}-positive--border-bottom-color`,borderBottomNegative:`${Y}-negative--border-bottom-color`,borderRightPositive:`${Y}-positive--border-right-color`,borderRightNegative:`${Y}-negative--border-right-color`,color:[`${Y}--color`,"color"],columnHeaderBackgroundColor:`${Y}-header--background`,columnHeaderSeparatorColor:`${Y}-separator--color`,columnHeaderColor:`${Y}-header--color`,columnHeaderForegroundSelectionColor:`${Y}-header--color`,columnColorNumberPositive:`${Y}-positive--color`,columnColorNumberNegative:`${Y}-negative--color`,columnBackgroundColorNumberPositive:`${Y}-positive--background`,columnBackgroundColorNumberNegative:`${Y}-negative--background`,selectionRegionOverlayColor:`${Y}-editor--background`,selectionRegionOutlineColor:`${Y}-editor--border-color`,gridLinesVColor:`${Y}-gridline--color`,gridLinesHColor:`${Y}-gridline--color`,lineColor:`${Y}-gridline--color`,fixedLinesVColor:`${Y}-gridline--color`,fixedLinesHColor:`${Y}-gridline--color`,halign:`${Y}--text-align`,columnHeaderHalign:`${Y}--text-align`,hoverCellHighlight:{enabled:!0,backgroundColor:`${Y}-cell-hover--background`,color:`${Y}-cell-hover--color`}}),G.add_measures({defaultRowHeight:`${Y}-row--height`,groupedHeader:{flatHeight:`${Y}-row--height`},width:`${Y}--width`,minimumColumnWidth:`${Y}--min-width`,maximumColumnWidth:`${Y}--max-width`}),G.add_styles({hoverRowHighlight:{enabled:!0,backgroundColor:`${Y}-row-hover--background`,color:`${Y}-row-hover--color`}});const Q={autoSelectRows:!1,cellPadding:5,cellSelection:!1,columnSelection:!1,rowSelection:!1,checkboxOnlyRowSelections:!1,columnClip:!0,treeHeaderBackgroundSelectionColor:"rgba(147, 185, 255, 0.625)",columnHeaderFont:"12px Helvetica, sans-serif",columnHeaderForegroundSelectionFont:"12px Helvetica, sans-serif",columnHeaderBackgroundSelectionColor:void 0,columnsReorderable:!1,defaultRowHeight:24,enableContinuousRepaint:!1,feedbackCount:1e6,fixedColumnCount:0,fixedRowCount:0,fixedLinesHWidth:1,fixedLinesVWidth:1,font:'12px "Arial", Helvetica, sans-serif',foregroundSelectionFont:'12px "Arial", Helvetica, sans-serif',gridLinesH:!1,gridLinesV:!0,gridLinesUserDataArea:!1,groupedHeader:{flatHeight:"30",paintBackground:null,columnHeaderLines:!1,groupConfig:[{halign:"center",font:"12px Open Sans, sans-serif"}]},halign:"left",headerTextWrapping:!1,hoverColumnHighlight:{enabled:!1},hoverRowHighlight:{enabled:!0,backgroundColor:"#555"},hoverCellHighlight:{enabled:!0,backgroundColor:"#333"},noDataMessage:"",minimumColumnWidth:50,multipleSelections:!1,renderFalsy:!1,rowHeaderFont:"12px Arial, Helvetica, sans-serif",rowHeaderForegroundSelectionFont:'12px "Arial", Helvetica, sans-serif',rowResize:!0,scrollbarHoverOff:"visible",rowHeaderCheckboxes:!1,rowHeaderNumbers:!1,selectionRegionOverlayColor:"transparent",selectionRegionOutlineColor:"rgba(0,0,0,0.2)",showFilterRow:!0,showHeaderRow:!0,showTreeColumn:!1,showRowNumbers:!1,showCheckboxes:!1,singleRowSelectionMode:!1,sortColumns:[],sortOnDoubleClick:!0,treeRenderer:"TreeCell",treeHeaderFont:"12px Arial, Helvetica, sans-serif",treeHeaderForegroundSelectionFont:'12px "Arial", Helvetica, sans-serif',useBitBlit:!1,vScrollbarClassPrefix:"",voffset:0},Z={backgroundColor:"#ffffff",color:"#666",font:'12px "Open Sans", Helvetica, sans-serif',columnHeaderColor:"#666",columnHeaderHalign:"left",columnHeaderBackgroundColor:"#fff",columnHeaderForegroundSelectionColor:"#333",rowHeaderForegroundSelectionFont:"12px Arial, Helvetica, sans-serif",treeHeaderColor:"#666",treeHeaderBackgroundColor:"#fff",hoverCellHighlight:{enabled:!0,backgroundColor:"#eeeeee"},hoverRowHighlight:{enabled:!0,backgroundColor:"#f6f6f6"}},ee={rowBackgroundSelectionColor:"rgba(147, 185, 255, 0.625)",cellBackgroundSelectionColor:"#fff",rowSelectionRegionOutlineColor:"transparent",cellSelectionRegionOutlineColor:"rgba(0,0,0,0.2)"};var te=i(19),ie=(i(22),i(2)),oe=i.n(ie);function re(e){return e+"px"}function ne(e){const t=new Date(e);return!(t instanceof Date&&!isNaN(t))}function se(e){const t=this.el.style;t.left=re(e.x-1),t.top=re(e.y-1),t.width=re(e.width+52),t.height=re(e.height+2)}function ae(e){const t=this.el.style;t.left=re(e.x-1),t.top=re(e.y-1),t.width=re(e.width+2),t.height=re(e.height+2)}function le(e){if(null===e)return;const t=new Date(e),i=("0"+t.getDate()).slice(-2),o=("0"+(t.getMonth()+1)).slice(-2);this.input.value=`${t.getFullYear()}-${o}-${i}`,this.input.addEventListener("keydown",fe.bind(this))}function de(e){if(null===e)return;const t=new Date(e),i=("0"+t.getDate()).slice(-2),o=("0"+(t.getMonth()+1)).slice(-2),r=("0"+t.getHours()).slice(-2),n=("0"+t.getMinutes()).slice(-2),s=("0"+t.getSeconds()).slice(-2);this.input.value=`${t.getFullYear()}-${o}-${i}T${r}:${n}:${s}`,this.input.addEventListener("keydown",fe.bind(this))}function ce(e){return this.input.addEventListener("keydown",fe.bind(this)),this.input.addEventListener("mouseover",e=>{var t=document.createEvent("MouseEvents");t.initMouseEvent("mouseover",e.canBubble,e.cancelable,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKye,e.shiftKey,e.metaKey,e.button,e.relatedTarget),this._canvas.dispatchEvent(t)}),null===e?"":(this.input.value=this.localizer.format(e),e)}function _e(e){return this._row.then(([t])=>{const i=t.__INDEX__;delete t.__INDEX__;const o=Object.keys(t)[0];this._table.update([{__INDEX__:i,[o]:e}])}),this.localizer.format(e)}function he(e){return this._row.then(([t])=>{const i=t.__INDEX__;delete t.__INDEX__;const o=Object.keys(t)[0];this._table.update([{__INDEX__:i,[o]:Number(e.replace(/,/g,""))}])}),this.localizer.format(e)}function ue(e){return e=new Date(e),this._row.then(([t])=>{const i=t.__INDEX__;delete t.__INDEX__;const o=Object.keys(t)[0];this._table.update([{__INDEX__:i,[o]:e}])}),this.localizer.format(e)}function ge(e){if(!(e&&e===this.initialValue)&&this.grid.fireBeforeCellEdit(this.event.gridCell,this.initialValue,e,this)){const t=this.event.gridCell.y+this.grid.renderer.dataWindow.top-1,i=this.event.gridCell.x;this._data[t][i]=e,this.grid.canvas.paintNow()}}function pe(){}function fe(e){e.stopPropagation();let t,i,o=this.grid,r=this.event.properties,n=r.feedbackCount,s=o.canvas.getKeyChar(e);return(t=this.specialKeyups[e.keyCode])&&(i=this[t](n))&&o.repaint(),r.mappedNavKey(s,e.ctrlKey)&&!t&&(i=this.stopEditing(n))&&o.repaint(),this.grid.fireSyntheticEditorKeyUpEvent(this,e),i}function ve(e){var t=this.input.value;try{var i=this.validateEditorValue(t);if(!i)var o=this.getEditorValue(t)}catch(e){i=e}if(!i&&this.grid.fireSyntheticEditorDataChangeEvent(this,this.initialValue,o))try{this.saveEditorValue(o)}catch(e){i=e}if(i)e>=0?this.errorEffectBegin(++this.errors%e==0&&i):this.cancelEditing();else{const{x:e,y:t}=this.grid.selectionModel.getLastSelection().origin;this.grid.selectionModel.select(e,t+1,0,0),this.hideEditor(),this.grid.cellEditor=null,this.grid._is_editing=!0,this.el.remove(),this.grid._is_editing=!1,this.grid.div.parentNode.parentNode.host.focus()}return!i}function me(){return this.setEditorValue(this.initialValue),this.hideEditor(),this.grid.cellEditor=null,this.grid._is_editing=!0,this.el.remove(),this.grid._is_editing=!1,this.grid.takeFocus(),!0}function be(e,t){var i=t.bounds.x,o=t.bounds.y,r=t.bounds.width,n=t.bounds.height;if(t.minWidth=1,null===t.value)return;var s=t.value.rollup,a=t.value.isLeaf,l=t.value.rowPath.length-1,d=t.expanded,c=t.last,_=t.backgroundColor;t.isSelected&&(_=t.backgroundSelectionColor),t.isRowHovered&&t.hoverRowHighlight.enabled&&!t.isCellHovered?_=t.hoverRowHighlight.backgroundColor:t.isCellHovered&&t.hoverCellHighlight.enabled&&(_=t.hoverCellHighlight.backgroundColor),e.save(),e.cache.fillStyle=_,e.rect(i,o,r,n),e.fillRect(i,o,r,n);var h=t.gridLinesHColor;e.cache.strokeStyle=h,e.cache.fillStyle=h;var u=i;e.globalAlpha=.7,e.strokeStyle=h,e.beginPath();for(var g=1;g<=l;g++){u+=16;var p=c&&!d?n/2:n;e.moveTo(u,o),e.lineTo(u,o),e.lineTo(u,o+p),g===l?(e.moveTo(u,o+n/2),e.lineTo(u,o+n/2),e.lineTo(u+16-3,o+n/2)):e.lineTo(u,o+n)}a?e.lineTo(u+16+3,o+n/2):(e.moveTo(u+16+3,o+n/2),e.arc(u+16,o+n/2,3,0,2*Math.PI),t.isCellHovered&&(e.globalAlpha=1,e.fill(),e.globalAlpha=.7)),d&&!a&&(e.globalAlpha=.5,e.fill(),e.moveTo(u+16,o+n/2+3),e.lineTo(u+16,o+n),e.globalAlpha=.7),e.stroke(),e.closePath(),e.globalAlpha=1,e.fillStyle=t.isSelected?t.foregroundSelectionColor:t.color,e.textAlign="start",e.textBaseline="middle",e.font=t.isSelected?t.foregroundSelectionFont:t.treeHeaderFont;var f=u+16+6+3;let v=t.formatValue(s,t._type);t.minWidth=f+e.getTextWidth(v)+15;var m=e.getTextWidthTruncated(v,r-f+(i-3),!0),b=o+n/2;e.fillText(m.string?m.string:v,f,b),e.restore()}function we(){return Reflect.construct(HTMLElement,[],this.__proto__.constructor)}Object.setPrototypeOf(we.prototype,HTMLElement.prototype),Object.setPrototypeOf(we,HTMLElement),d.a.prototype.stopResizeLoop(),d.a.prototype.stopPaintLoop(),Object(K.bindTemplate)(I.a,q.a)(class extends we{set_data(e,t,i,o,r,n=!1){const s=Object(D.psp2hypergrid)(e,t,i,o,r);this.grid?this.grid.behavior.setPSP(s,n):this._hg_data=s}connectedCallback(){if(!this.grid){const e=this.shadowRoot.querySelector("#mainGrid");e.setAttribute("hidden",!0),d.a.prototype.restartPaintLoop(),this.grid=new n.a(e,{DataModel:W}),d.a.prototype.stopPaintLoop(),e.removeAttribute("hidden"),this.grid.get_styles=()=>J(this),this.grid.get_dynamic_styles=(...e)=>(function(e,t){const i={singleRowSelectionMode:t,autoSelectRows:t,rowSelection:t};return t?(i.selectionRegionOutlineColor=Object(F.get_style)(e,`${Y}-selection--border-color`)||ee.rowSelectionRegionOutlineColor,i.backgroundSelectionColor=Object(F.get_style)(e,`${Y}-selection--background`)||ee.rowBackgroundSelectionColor):(i.selectionRegionOutlineColor=Object(F.get_style)(e,`${Y}-editor--border-color`)||ee.cellSelectionRegionOutlineColor,i.backgroundSelectionColor=ee.rowSelectionRegionOutlineColor),i})(this,...e);const t=Object.assign({},z()(Q),z()(Z)),i=J(this);t.renderer=["SimpleCell","Borders"],Object.assign(t.groupedHeader,i[""].groupedHeader),"number"==typeof t.groupedHeader.flatHeight&&(t.groupedHeader.flatHeight=t.groupedHeader.flatHeight.toString()),this.grid.installPlugins([o,[_.a,t.groupedHeader]]);let r=this.grid.cellRenderers.items.GroupedHeader.paint;this.grid.cellRenderers.items.GroupedHeader.paint=function(e,t){return this.visibleColumns=t.grid.renderer.visibleColumns,r.call(this,e,t)},this.grid.addProperties(t),this.grid.addProperties(i[""]),Object(te.a)(this.grid),function(e){const t=oe.a.extend("perspective-date",{localizer:e.localization.get("chromeDate"),template:"<input class='hypergrid-textfield' type='date'>",getEditorValue:ue,setEditorValue:le,validateEditorValue:ne,setBounds:se,selectAll:()=>{},saveEditorValue:ge,keyup:pe,stopEditing:ve,cancelEditing:me}),i=oe.a.extend("perspective-datetime",{localizer:e.localization.get("chromeDate"),template:"<input class='hypergrid-textfield' type='datetime-local'>",getEditorValue:ue,setEditorValue:de,validateEditorValue:ne,setBounds:se,selectAll:()=>{},saveEditorValue:ge,keyup:pe,stopEditing:ve,cancelEditing:me}),o=oe.a.extend("perspective-text",{setBounds:ae,setEditorValue:ce,getEditorValue:_e,saveEditorValue:ge,keyup:pe,stopEditing:ve,cancelEditing:me}),r=oe.a.extend("perspective-number",{setBounds:ae,setEditorValue:ce,getEditorValue:he,validateEditorValue:e=>isNaN(Number(e.replace(/,/g,""))),saveEditorValue:ge,keyup:pe,stopEditing:ve,cancelEditing:me});e.cellEditors.add(r),e.cellEditors.add(t),e.cellEditors.add(i),e.cellEditors.add(o)}(this.grid),this.grid.cellRenderers.add("TreeCell",a.a.extend({paint:be})),this._hg_data&&(this.grid.behavior.setPSP(this._hg_data),delete this._hgdata)}}});const Ee=Symbol("Hypergrid private");function ye(){return this[Ee]?this[Ee].grid:void 0}async function Ce(e){let t;return ye.call(this)?t=this[Ee]:(t=this[Ee]=document.createElement("perspective-hypergrid"),t.setAttribute("tabindex",1),t.addEventListener("blur",()=>{t.grid&&!t.grid._is_editing&&(t.grid.selectionModel.clear(!0),t.grid.paintNow())})),t.isConnected||(e.innerHTML="",e.appendChild(t),await new Promise(e=>setTimeout(e)),t.grid.canvas.resize(!1)),t}function xe(e,t){const i=e.divCanvas;e.divCanvas=void 0,t(),e.divCanvas=i}const Pe={name:"Grid",create:async function(e,t,i,o,r,n){let s=ye.call(this);s&&(s.behavior.dataModel._view=void 0,s.behavior.dataModel._table=void 0,xe(s,()=>s.allowEvents(!1)));const a=await t.get_config();if(i.cancelled)return;const l=a.column_pivots,d=a.row_pivots,c={start_row:0,end_row:1,id:0===d.length&&0===l.length},[_,h,u,g,p]=await Promise.all([t.num_rows(),t.to_columns(c),t.schema(),this._table.schema(),t.column_paths()]);if(i.cancelled)return;let f=await Ce.call(this,e);if(s=ye.call(this),i.cancelled)return;const v=p.filter(e=>"__INDEX__"!==e),m=s.behavior.dataModel;m._grid=s,m.setIsTree(d.length>0),m.setDirty(_),m.clearSelectionState(),m._view=t,m._table=this._table,m._config=a,m._viewer=this,m._columns=v,m._pad_window=this.hasAttribute("settings"),s.renderer.needsComputeCellsBounds=!0,xe(s,()=>f.set_data(h,u,g,d,v,n)),s.behavior.dataModel._outstanding&&await s.behavior.dataModel._outstanding.req,this._plugin_config&&(xe(s,()=>m.setSelectedRowID(this._plugin_config.selected)),delete this._plugin_config),await s.canvas.resize(!0),s.allowEvents(!0)},selectMode:"toggle",update:async function(e,t,i){const o=await t.num_rows();if(i.cancelled)return;const r=ye.call(this);if(!r)return;const n=r.behavior.dataModel;n._view=t,n._table=this._table,n.setDirty(o),r.behaviorChanged(),r.canvas.paintNow()},deselectMode:"pivots",styleElement:function(){if(this[Ee]){const t=this[Ee];e=t,G.clear_properties(e);const i=J(t);t.grid&&t.grid.addProperties(i[""]),t.grid.behavior.createColumns(),t.grid.canvas.paintNow()}var e},save:function(){const e=ye.call(this);if(e&&e.selectionModel.hasRowSelections())return{selected:e.behavior.dataModel.getSelectedRowID()}},restore:function(e){this._plugin_config=e},resize:async function(){const e=ye.call(this);if(e){let t=await this._view.num_rows();e.behavior.dataModel.setDirty(t),await e.canvas.resize(!0)}},delete:function(){const e=ye.call(this);e&&(e.terminate(),e.div=void 0,e.canvas.div=void 0,e.canvas.canvas=void 0,e.sbVScroller=void 0,e.sbHScroller=void 0,delete this[Ee])}};Object(K.registerPlugin)("hypergrid",Pe)}])}));
//# sourceMappingURL=perspective-viewer-hypergrid.js.map